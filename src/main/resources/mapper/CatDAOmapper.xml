<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atlas.dao.CatDAO">
    <select id="recommend" resultMap="Catr">
        select cid,sum(liked) liked,name from picture where fid is null group by cid order by liked desc limit 16
    </select>

    <resultMap id="Catr" type="com.atlas.entity.Cat">
        <id column="cid" property="cid"></id>
        <result column="name" property="name"></result>
        <result column="liked" property="liked"></result>
        <collection property="picture" select="findpicture" column="cid"></collection>
    </resultMap>

    <select id="catdetail" parameterType="Picture" resultType="Cat">
        select c.*,p.* from cat c,picture p where pid=#{pid} and p.cid=c.cid
    </select>

    <select id="search" parameterType="Picture" resultType="Cat">
        select * from cat where name like concat('%',#{information},'%')
                        or color like concat('%',#{information},'%')
                        or place like concat('%',#{information},'%')
    </select>

    <resultMap id="gbcolor" type="com.atlas.entity.Cat">
        <id property="cid" column="cid"></id>
        <result property="color" column="color"></result>
        <result property="cid" column="cid"></result>
        <result property="name" column="name"></result>
        <collection property="picture" select="findpicture" column="cid"></collection>
    </resultMap>

    <select id="findpicture" resultType="Picture">
        select * from picture where cid=#{cid} order by rand() limit 1
    </select>

    <select id="findall" parameterType="Cat" resultMap="gbcolor">
        select c.*  from cat c where color=#{color}
    </select>

    <select id="findcolor" resultType="String">
        select distinct color from cat
    </select>
</mapper>