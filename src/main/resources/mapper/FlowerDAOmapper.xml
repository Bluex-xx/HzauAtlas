<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atlas.dao.FlowerDAO">
    <select id="recommend" resultType="Flower">
        select * from flower order by rand() limit 1
    </select>

    <select id="flowerdetail" parameterType="Picture" resultType="Flower">
        select f.*,p.* from flower f,picture p where pid=#{pid} and p.fid=f.fid
    </select>

    <select id="search" parameterType="Picture" resultType="Flower">
        select * from flower where variety like concat('%',#{information},'%')
                             or florescence like concat('%',#{information},'%')
                             or department like concat('%',#{information},'%')
                             or allegory like concat('%',#{information},'%')
    </select>

    <resultMap id="florescence" type="com.atlas.entity.Flower">
        <id property="florescence" column="florescence"></id>
        <result property="florescence" column="florescence"></result>
        <result property="fid" column="fid"></result>
        <collection property="flowerList" ofType="com.atlas.entity.Flower">
            <result property="variety" column="variety"></result>
            <result property="department" column="department"></result>
            <result property="allegory" column="allegory"></result>
            <collection property="picture" select="findpicture" column="fid"></collection>
        </collection>
    </resultMap>

    <resultMap id="variety" type="com.atlas.entity.Flower">
        <id property="variety" column="variety"></id>
        <result property="variety" column="variety"></result>
        <result property="fid" column="fid"></result>
        <collection property="flowerList" ofType="com.atlas.entity.Flower">
            <result property="florescence" column="florescence"></result>
            <result property="department" column="department"></result>
            <result property="allegory" column="allegory"></result>
            <collection property="picture" select="findpicture" column="fid"></collection>
        </collection>
    </resultMap>

    <select id="findpicture" resultType="Picture">
        select * from picture where fid=#{fid} order by rand() limit 1
    </select>

    <select id="classifyflorescence" resultMap="florescence">
        select f.*  from flower f
    </select>

    <select id="classifyvariety" resultMap="variety">
        select f.*  from flower f
    </select>
</mapper>